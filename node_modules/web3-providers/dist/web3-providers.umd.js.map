{"version":3,"file":"web3-providers.umd.js","sources":["../node_modules/underscore-es/isObject.js","../node_modules/underscore-es/_quickaccess.js","../node_modules/underscore-es/isFunction.js","../src/resolvers/ProviderResolver.js","../src/detectors/ProviderDetector.js","../src/mappers/JsonRpcMapper.js","../src/validators/JsonRpcResponseValidator.js","../lib/adapters/AbstractProviderAdapter.js","../src/adapters/SocketProviderAdapter.js","../src/adapters/InpageProviderAdapter.js","../src/adapters/HttpProviderAdapter.js","../node_modules/underscore-es/isArray.js","../src/providers/WebsocketProvider.js","../src/providers/IpcProvider.js","../src/providers/HttpProvider.js","../src/batch-request/BatchRequest.js","../src/factories/ProvidersModuleFactory.js","../src/index.js"],"sourcesContent":["// `_isObject` : an object's function\n// -----------------------------------\n\n// Is a given variable an object?\nexport default function (obj) {\n\tvar type = typeof obj;\n\treturn type === 'function' || type === 'object' && !!obj;\n}","// quick reference variables for speed access\n//-------------------------------------------\n\n// Save bytes in the minified (but not gzipped) version:\nexport const ArrayProto = Array.prototype;\nexport const ObjProto = Object.prototype;\nexport const SymbolProto = typeof Symbol !== 'undefined' ? Symbol.prototype : null;\n\n// Create quick reference variables for speed access to core prototypes.\nexport const push = ArrayProto.push;\nexport const slice = ArrayProto.slice;\nexport const toString = ObjProto.toString;\nexport const hasOwnProperty = ObjProto.hasOwnProperty;\n\n// All **ECMAScript 5** native function implementations that we hope to use\n// are declared here.\nexport const nativeIsArray = Array.isArray;\nexport const nativeKeys = Object.keys;\nexport const nativeCreate = Object.create;\n\n// Naked function reference for surrogate-prototype-swapping.\nexport const Ctor = function () {};","// `_isFunction` : an object's function\n// -------------------------------------\n\nimport {toString} from './_quickaccess';\n\n// Optimize `isFunction` if appropriate. Work around some typeof bugs in old v8,\n// IE 11 (#1621), Safari 8 (#1929), and PhantomJS (#2236).\nfunction customFunction() {\n\tif (typeof /./ != 'function' && typeof Int8Array != 'object' && typeof document !== 'undefined' && typeof document.childNodes != 'function') {\n\t\treturn (obj) => typeof obj == 'function' || false;\n\t}\n\treturn null;\n}\n\n// Is a given value a function?\nvar _isFunction = customFunction() || function (obj) {\n\treturn toString.call(obj) === '[object Function]';\n}\n\nexport {_isFunction as default};","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file ProviderResolver.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nimport isObject from 'underscore-es/isObject';\nimport isFunction from 'underscore-es/isFunction';\n\nexport default class ProviderResolver {\n    /**\n     * @param {ProvidersModuleFactory} providersPackageFactory\n     *\n     * @constructor\n     */\n    constructor(providersPackageFactory) {\n        this.providersPackageFactory = providersPackageFactory;\n    }\n\n    /**\n     * Resolves the correct provider with his adapter\n     *\n     * @method resolve\n     *\n     * @param {*} provider\n     * @param {Net} net\n     *\n     * @returns {AbstractProviderAdapter|Error}\n     */\n    resolve(provider, net) {\n        if (typeof provider === 'string') {\n            // HTTP\n            if (/^http(s)?:\\/\\//i.test(provider)) {\n                return this.providersPackageFactory.createHttpProviderAdapter(\n                    this.providersPackageFactory.createHttpProvider(provider)\n                );\n            }\n            // WS\n            if (/^ws(s)?:\\/\\//i.test(provider)) {\n                return this.providersPackageFactory.createSocketProviderAdapter(\n                    this.providersPackageFactory.createWebsocketProvider(provider)\n                );\n            }\n\n            // IPC\n            if (provider && isObject(net) && isFunction(net.connect)) {\n                return this.providersPackageFactory.createSocketProviderAdapter(\n                    this.providersPackageFactory.createIpcProvider(provider, net)\n                );\n            }\n        }\n\n        if (isFunction(provider.sendAsync)) {\n            return this.providersPackageFactory.createInpageProviderAdapter(provider);\n        }\n\n        switch (provider.constructor.name) {\n            case 'HttpProvider':\n                return this.providersPackageFactory.createHttpProviderAdapter(provider);\n            case 'WebsocketProvider':\n            case 'IpcProvider':\n                return this.providersPackageFactory.createSocketProviderAdapter(provider);\n            case 'EthereumProvider':\n            case 'HttpProviderAdapter':\n            case 'SocketProviderAdapter':\n            case 'InpageProviderAdapter':\n                return provider;\n        }\n\n        throw new Error('Please provide an valid Web3 provider or the EthereumProvider');\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file ProviderDetector.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\n/* eslint-disable no-new-func */\nlet global;\ntry {\n    global = new Function('return this')();\n} catch (error) {\n    global = window;\n}\n/* eslint-enable */\n\nexport default class ProviderDetector {\n    /**\n     * Detects which provider is given in the current environment\n     *\n     * @method detect\n     *\n     * @returns {Object|Undefined} provider\n     */\n    detect() {\n        if (typeof global.ethereumProvider !== 'undefined') {\n            return global.ethereumProvider;\n        }\n\n        if (typeof global.web3 !== 'undefined' && global.web3.currentProvider) {\n            if (this.isIpcProviderWrapper(global.web3.currentProvider)) {\n                global.web3.currentProvider = this.addSubscriptionsToIpcProviderWrapper(global.web3.currentProvider);\n            }\n\n            return global.web3.currentProvider;\n        }\n    }\n\n    /**\n     * Checks if the given provider is of type ipcProviderWrapper\n     *\n     * @method isIpcProviderWrapper\n     *\n     * @param {Object} currentProvider\n     *\n     * @returns {Boolean}\n     */\n    isIpcProviderWrapper(currentProvider) {\n        return (\n            !currentProvider.on &&\n            currentProvider.connection &&\n            currentProvider.connection.constructor.name === 'ipcProviderWrapper'\n        );\n    }\n\n    /**\n     * Adds the on method for the subscriptions to the ipcProviderWrapper\n     *\n     * @method addSubscriptionsToIpcProviderWrapper\n     *\n     * @param {Object} provider\n     *\n     * @returns {Object}\n     */\n    addSubscriptionsToIpcProviderWrapper(provider) {\n        provider.on = (type, callback) => {\n            if (typeof callback !== 'function') {\n                throw new TypeError('The second parameter callback must be a function.');\n            }\n\n            switch (type) {\n                case 'data':\n                    this.connection.on('data', (data) => {\n                        let result = '';\n\n                        data = data.toString();\n\n                        try {\n                            result = JSON.parse(data);\n                        } catch (error) {\n                            return callback(new Error(`Couldn't parse response data${data}`));\n                        }\n\n                        // notification\n                        if (!result.id && result.method.indexOf('_subscription') !== -1) {\n                            callback(null, result);\n                        }\n                    });\n                    break;\n                default:\n                    this.connection.on(type, callback);\n                    break;\n            }\n        };\n\n        return provider;\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file JsonRpcMapper.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nlet messageId = 0;\n\nexport default class JsonRpcMapper {\n    /**\n     * Creates a valid json payload object\n     *\n     * @method toPayload\n     *\n     * @param {String} method\n     * @param {Array} params\n     *\n     * @returns {Object}\n     */\n    static toPayload(method, params) {\n        if (!method) {\n            throw new Error(`JSONRPC method should be specified for params: \"${JSON.stringify(params)}\"!`);\n        }\n\n        messageId++;\n\n        return {\n            jsonrpc: '2.0',\n            id: messageId,\n            method,\n            params: params || []\n        };\n    }\n\n    /**\n     * Creates a batch payload object\n     *\n     * @method toBatchPayload\n     *\n     * @param {Array} requests\n     *\n     * @returns {Array}\n     */\n    static toBatchPayload(requests) {\n        return requests.map((request) => {\n            request.beforeExecution();\n\n            return JsonRpcMapper.toPayload(request.rpcMethod, request.parameters);\n        });\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file JsonRpcResponseValidator.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nexport default class JsonRpcResponseValidator {\n    /**\n     * Executes JSON-RPC response validation\n     *\n     * @method isValid\n     *\n     * @param {Object} response\n     *\n     * @returns {Boolean}\n     */\n    static isValid(response) {\n        if (Array.isArray(response)) {\n            return response.every(this.isResponseItemValid);\n        }\n\n        return this.isResponseItemValid(response);\n    }\n\n    /**\n     * Validates response item from a JSON-RPC response\n     *\n     * @method isResponseItemValid\n     *\n     * @param {Object} response\n     *\n     * @returns {Boolean}\n     */\n    static isResponseItemValid(response) {\n        return (\n            !!response &&\n            !response.error &&\n            response.jsonrpc === '2.0' &&\n            (typeof response.id === 'number' || typeof response.id === 'string') &&\n            response.result !== undefined\n        );\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file AbstractProviderAdapter.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nimport JsonRpcMapper from '../../src/mappers/JsonRpcMapper.js';\nimport JsonRpcResponseValidator from '../../src/validators/JsonRpcResponseValidator.js';\nimport {errors} from 'web3-core-helpers';\nimport EventEmitter from 'eventemitter3';\n\nexport default class AbstractProviderAdapter extends EventEmitter {\n    /**\n     * @param {Object} provider\n     *\n     * @constructor\n     */\n    constructor(provider) {\n        super();\n        this.provider = provider;\n    }\n\n    /**\n     * Sends the JSON-RPC request\n     *\n     * @method send\n     *\n     * @param {String} method\n     * @param {Array} parameters\n     *\n     * @returns {Promise<any>}\n     */\n    send(method, parameters) {\n        const payload = JsonRpcMapper.toPayload(method, parameters);\n\n        return new Promise((resolve, reject) => {\n            this.provider.send(payload, (error, response) => {\n                this.handleResponse(reject, resolve, error, response, payload);\n            });\n        });\n    }\n\n    /**\n     * Sends batch payload\n     *\n     * @method sendBatch\n     *\n     * @param {Array} payload\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    sendBatch(payload, callback) {\n        this.provider.send(payload, callback);\n    }\n\n    /**\n     * Returns Promise with an error if the method is not overwritten\n     *\n     * @method subscribe\n     *\n     * @returns {Promise<Error>}\n     */\n    subscribe() {\n        return new Promise((resolve, reject) => {\n            reject(new Error(`The current provider does not support subscriptions: ${this.provider.constructor.name}`));\n        });\n    }\n\n    /**\n     * Returns Promise with an error if the method is not overwritten\n     *\n     * @method unsubscribe\n     *\n     * @returns {Promise<Error>}\n     */\n    unsubscribe() {\n        return new Promise((resolve, reject) => {\n            reject(new Error(`The current provider does not support subscriptions: ${this.provider.constructor.name}`));\n        });\n    }\n\n    /**\n     * Handles the JSON-RPC response\n     *\n     * @method handleResponse\n     *\n     * @param {Function} reject\n     * @param {Function} resolve\n     * @param {Object} error\n     * @param {Object} response\n     * @param {Object} payload\n     */\n    handleResponse(reject, resolve, error, response, payload) {\n        if (response && response.id && payload.id !== response.id) {\n            reject(\n                new Error(\n                    `Wrong response id \"${response.id}\" (expected: \"${payload.id}\") in ${JSON.stringify(payload)}`\n                )\n            );\n\n            return;\n        }\n\n        if (response && response.error) {\n            reject(errors.ErrorResponse(response));\n\n            return;\n        }\n\n        if (!JsonRpcResponseValidator.isValid(response.result)) {\n            reject(errors.InvalidResponse(response));\n\n            return;\n        }\n\n        if (!error) {\n            resolve(response.result);\n\n            return;\n        }\n\n        reject(error);\n    }\n\n    /**\n     * Checks if the provider is connected\n     *\n     * @method isConnected\n     *\n     * @returns {Boolean}\n     */\n    isConnected() {\n        return this.provider.connected;\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file SocketProviderAdapter.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nimport AbstractProviderAdapter from '../../lib/adapters/AbstractProviderAdapter';\n\nexport default class SocketProviderAdapter extends AbstractProviderAdapter {\n    /**\n     * @param {Object} provider\n     *\n     * @constructor\n     */\n    constructor(provider) {\n        super(provider);\n        this.host = provider.path;\n        this.subscriptions = [];\n        this.registerSubscriptionListener();\n    }\n\n    /**\n     * Subscribes to a given subscriptionType\n     *\n     * @method subscribe\n     *\n     * @param {String} subscriptionMethod\n     * @param {String} subscriptionType\n     * @param {Array} parameters\n     *\n     * @returns {Promise<String|Error>}\n     */\n    subscribe(subscriptionType, subscriptionMethod, parameters) {\n        return this.send(subscriptionType, parameters.unshift(subscriptionMethod)).then((error, subscriptionId) => {\n            if (!error) {\n                this.subscriptions.push(subscriptionId);\n\n                return subscriptionId;\n            }\n\n            throw new Error(`Provider error: ${error}`);\n        });\n    }\n\n    /**\n     * Unsubscribes the subscription by his id\n     *\n     * @method unsubscribe\n     *\n     * @param {String} subscriptionId\n     * @param {String} subscriptionType\n     *\n     * @returns {Promise<Boolean|Error>}\n     */\n    unsubscribe(subscriptionId, subscriptionType) {\n        return this.send(subscriptionType, [subscriptionId]).then(function(result) {\n            if (result) {\n                this.subscriptions = this.subscriptions.filter((subscription) => {\n                    return subscription !== subscriptionId;\n                });\n\n                return true;\n            }\n\n            return false;\n        });\n    }\n\n    /**\n     * Emits an event with the subscription id\n     *\n     * @method registerSubscriptionListener\n     */\n    registerSubscriptionListener() {\n        this.provider.on('data', (response, deprecatedResponse) => {\n            // this is for possible old providers, which may had the error first handler\n            response = response || deprecatedResponse;\n\n            // check for result.method, to prevent old providers errors to pass as result\n            if (response.method && this.hasSubscription(response.params.subscription)) {\n                this.emit(response.params.subscription, response.params.result);\n            }\n        });\n    }\n\n    /**\n     * Checks if the given subscription id exists\n     *\n     * @method hasSubscription\n     *\n     * @param {String} subscriptionId\n     *\n     * @returns {Boolean}\n     */\n    hasSubscription(subscriptionId) {\n        return this.subscriptions.indexOf(subscriptionId) > -1;\n    }\n\n    /**\n     * Clears all subscriptions and listeners\n     *\n     * @method clearSubscriptions\n     */\n    clearSubscriptions() {\n        const unsubscribePromises = [];\n\n        this.subscriptions.forEach((subscriptionId) => {\n            unsubscribePromises.push(this.unsubscribe(subscriptionId));\n        });\n\n        Promise.all(unsubscribePromises).then(() => {\n            this.provider.reset();\n            this.subscriptions = [];\n        });\n    }\n\n    /**\n     * Removes subscription from subscriptions list and unsubscribes it.\n     *\n     * @method removeSubscription\n     *\n     * @param {String} subscriptionId\n     * @param {String} subscriptionType\n     *\n     * @returns {Promise<Boolean>}\n     */\n    removeSubscription(subscriptionId, subscriptionType) {\n        return this.unsubscribe(subscriptionId, subscriptionType).then((result) => {\n            if (result) {\n                delete this.subscriptions[this.subscriptions.indexOf(subscriptionId)];\n\n                return true;\n            }\n\n            return false;\n        });\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <Legacy://www.gnu.org/licenses/>.\n*/\n/**\n * @file InpageProviderAdapter.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nimport AbstractProviderAdapter from '../../lib/adapters/AbstractProviderAdapter';\n\nexport default class InpageProviderAdapter extends AbstractProviderAdapter {\n    /**\n     * @param {Object} inpageProvider\n     *\n     * @constructor\n     */\n    constructor(inpageProvider) {\n        // TODO: Check if there is a way to set a host property (will be used on setProvider)\n        super(inpageProvider);\n        this.provider.send = this.provider.sendAsync;\n        delete this.provider.sendAsync;\n    }\n\n    /**\n     * Checks if the provider is connected\n     *\n     * @method isConnected\n     *\n     * @returns {Boolean}\n     */\n    isConnected() {\n        return this.provider.isConnected;\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file HttpProviderAdapter.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nimport AbstractProviderAdapter from '../../lib/adapters/AbstractProviderAdapter';\n\nexport default class HttpProviderAdapter extends AbstractProviderAdapter {\n    /**\n     * @param {HttpProvider} httpProvider\n     *\n     * @constructor\n     */\n    constructor(httpProvider) {\n        super(httpProvider);\n        this.host = httpProvider.host;\n    }\n}\n","// `_isArray` : an object's function\n// ----------------------------------\n\nimport {nativeIsArray, toString} from './_quickaccess';\n\n// Is a given value an array?\n// Delegates to ECMA5's native Array.isArray\nexport var _isArray = nativeIsArray || function (obj) {\n\treturn toString.call(obj) === '[object Array]';\n}\n\nexport {_isArray as default};","/*\n This file is part of web3.js.\n\n web3.js is free software: you can redistribute it and/or modify\n it under the terms of the GNU Lesser General Public License as published by\n the Free Software Foundation, either version 3 of the License, or\n (at your option) any later version.\n\n web3.js is distributed in the hope that it will be useful,\n but WITHOUT ANY WARRANTY; without even the implied warranty of\n MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n GNU Lesser General Public License for more details.\n\n You should have received a copy of the GNU Lesser General Public License\n along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n */\n/**\n * @file WebsocketProvider.js\n * @authors: Fabian Vogelsteller <fabian@ethereum.org>\n * @date 2017\n */\n\nimport isArray from 'underscore-es/isArray';\nimport isFunction from 'underscore-es/isFunction';\nimport {errors} from 'web3-core-helpers';\n\nlet Ws = null;\nlet _btoa = null;\nlet parseURL = null;\nif (typeof window !== 'undefined' && typeof window.WebSocket !== 'undefined') {\n    Ws = (url, protocols) => {\n        return new window.WebSocket(url, protocols);\n    };\n    _btoa = btoa;\n    parseURL = (url) => {\n        return new URL(url);\n    };\n} else {\n    Ws = require('websocket').w3cwebsocket;\n    _btoa = (str) => {\n        return Buffer.from(str, 'base64');\n    };\n    const url = require('url');\n    if (url.URL) {\n        // Use the new Node 6+ API for parsing URLs that supports username/password\n        const NewURL = url.URL;\n        parseURL = (url) => {\n            return new NewURL(url);\n        };\n    } else {\n        // Web3 supports Node.js 5, so fall back to the legacy URL API if necessary\n        parseURL = require('url').parse;\n    }\n}\n\nexport default class WebsocketProvider {\n    /**\n     * Default connection ws://localhost:8546\n     *\n     * @param {String} url\n     * @param {Object} options\n     *\n     * @constructor\n     */\n    constructor(url, options) {\n        this.responseCallbacks = {};\n        this.notificationCallbacks = [];\n        this.path = url;\n\n        options = options || {};\n        this._customTimeout = options.timeout;\n\n        // The w3cwebsocket implementation does not support Basic Auth\n        // username/password in the URL. So generate the basic auth header, and\n        // pass through with any additional headers supplied in constructor\n        const parsedURL = parseURL(url);\n        const headers = options.headers || {};\n        const protocol = options.protocol || undefined;\n        if (parsedURL.username && parsedURL.password) {\n            headers.authorization = `Basic ${_btoa(`${parsedURL.username}:${parsedURL.password}`)}`;\n        }\n\n        // Allow a custom client configuration\n        const clientConfig = options.clientConfig || undefined;\n\n        // When all node core implementations that do not have the\n        // WHATWG compatible URL parser go out of service this line can be removed.\n        if (parsedURL.auth) {\n            headers.authorization = `Basic ${_btoa(parsedURL.auth)}`;\n        }\n        this.connection = new Ws(url, protocol, undefined, headers, undefined, clientConfig);\n\n        this.addDefaultEvents();\n\n        // LISTEN FOR CONNECTION RESPONSES\n        this.connection.addEventListener('message', (e) => {\n            const data = typeof e.data === 'string' ? e.data : '';\n\n            this._parseResponse(data).forEach((result) => {\n                let id = null;\n\n                // get the id which matches the returned id\n                if (isArray(result)) {\n                    result.forEach((load) => {\n                        if (this.responseCallbacks[load.id]) id = load.id;\n                    });\n                } else {\n                    id = result.id;\n                }\n\n                // notification\n                if (!id && result && result.method && result.method.indexOf('_subscription') !== -1) {\n                    this.notificationCallbacks.forEach((callback) => {\n                        if (isFunction(callback)) callback(result);\n                    });\n\n                    // fire the callback\n                } else if (this.responseCallbacks[id]) {\n                    this.responseCallbacks[id](null, result);\n                    delete this.responseCallbacks[id];\n                }\n            });\n        });\n\n        // make property `connected` which will return the current connection status\n        Object.defineProperty(this, 'connected', {\n            get() {\n                return this.connection && this.connection.readyState === this.connection.OPEN;\n            },\n            enumerable: true\n        });\n    }\n\n    /**\n     * Will add the error and end event to timeout existing calls\n     *\n     * @method addDefaultEvents\n     */\n    addDefaultEvents() {\n        this.connection.addEventListener('error', () => {\n            this._timeout();\n        });\n\n        this.connection.onclose = () => {\n            this._timeout();\n\n            // reset all requests and callbacks\n            this.reset();\n        };\n\n        // this.connection.on('timeout', function(){\n        //     this._timeout();\n        // });\n    }\n\n    /**\n     * Will parse the response and make an array out of it.\n     *\n     * @method _parseResponse\n     *\n     * @param {String} data\n     */\n    _parseResponse(data) {\n        const returnValues = [];\n\n        // DE-CHUNKER\n        const dechunkedData = data\n            .replace(/\\}[\\n\\r]?\\{/g, '}|--|{') // }{\n            .replace(/\\}\\][\\n\\r]?\\[\\{/g, '}]|--|[{') // }][{\n            .replace(/\\}[\\n\\r]?\\[\\{/g, '}|--|[{') // }[{\n            .replace(/\\}\\][\\n\\r]?\\{/g, '}]|--|{') // }]{\n            .split('|--|');\n\n        dechunkedData.forEach((data) => {\n            // prepend the last chunk\n            if (this.lastChunk) data = this.lastChunk + data;\n\n            let result = null;\n\n            try {\n                result = JSON.parse(data);\n            } catch (error) {\n                this.lastChunk = data;\n\n                // start timeout to cancel all requests\n                clearTimeout(this.lastChunkTimeout);\n                this.lastChunkTimeout = setTimeout(() => {\n                    this._timeout();\n                    throw errors.InvalidResponse(data);\n                }, 1000 * 15);\n\n                return;\n            }\n\n            // cancel timeout and set chunk to null\n            clearTimeout(this.lastChunkTimeout);\n            this.lastChunk = null;\n\n            if (result) returnValues.push(result);\n        });\n\n        return returnValues;\n    }\n\n    /**\n     * Adds a callback to the responseCallbacks object,\n     * which will be called if a response matching the response Id will arrive.\n     *\n     * @method _addResponseCallback\n     *\n     * @param {Object} payload\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    _addResponseCallback(payload, callback) {\n        const id = payload.id || payload[0].id;\n        const method = payload.method || payload[0].method;\n\n        this.responseCallbacks[id] = callback;\n        this.responseCallbacks[id].method = method;\n\n        // schedule triggering the error response if a custom timeout is set\n        if (this._customTimeout) {\n            setTimeout(() => {\n                if (this.responseCallbacks[id]) {\n                    this.responseCallbacks[id](errors.ConnectionTimeout(this._customTimeout));\n                    delete this.responseCallbacks[id];\n                }\n            }, this._customTimeout);\n        }\n    }\n\n    /**\n     * Timeout all requests when the end/error event is fired\n     *\n     * @method _timeout\n     */\n    _timeout() {\n        for (const key in this.responseCallbacks) {\n            if (this.responseCallbacks.hasOwnProperty(key)) {\n                this.responseCallbacks[key](errors.InvalidConnection('on WS'));\n                delete this.responseCallbacks[key];\n            }\n        }\n    }\n\n    /**\n     * Sends the JSON-RPC request\n     *\n     * @method send\n     *\n     * @param {Object} payload\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    send(payload, callback) {\n        if (this.connection.readyState === this.connection.CONNECTING) {\n            setTimeout(() => {\n                this.send(payload, callback);\n            }, 10);\n            return;\n        }\n\n        // try reconnect, when connection is gone\n        // if(!this.connection.writable)\n        //     this.connection.connect({url: this.url});\n        if (this.connection.readyState !== this.connection.OPEN) {\n            console.error('connection not open on send()');\n            if (typeof this.connection.onerror === 'function') {\n                this.connection.onerror(new Error('connection not open'));\n            } else {\n                console.error('no error callback');\n            }\n            callback(new Error('connection not open'));\n            return;\n        }\n\n        this.connection.send(JSON.stringify(payload));\n        this._addResponseCallback(payload, callback);\n    }\n\n    /**\n     * Subscribes to provider events.provider\n     *\n     * @method on\n     *\n     * @param {String} type 'notifcation', 'connect', 'error', 'end' or 'data'\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    on(type, callback) {\n        if (typeof callback !== 'function') throw new Error('The second parameter callback must be a function.');\n\n        switch (type) {\n            case 'data':\n                this.notificationCallbacks.push(callback);\n                break;\n\n            case 'connect':\n                this.connection.addEventListener('open', callback);\n                break;\n\n            case 'end':\n                this.connection.onclose = callback;\n                break;\n\n            case 'error':\n                this.connection.addEventListener('error', callback);\n                break;\n\n            // default:\n            //     this.connection.on(type, callback);\n            //     break;\n        }\n    }\n\n    // TODO: add once\n\n    /**\n     * Removes event listener\n     *\n     * @method removeListener\n     *\n     * @param {String} type 'notifcation', 'connect', 'error', 'end' or 'data'\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    removeListener(type, callback) {\n        switch (type) {\n            case 'data':\n                this.notificationCallbacks.forEach((cb, index) => {\n                    if (cb === callback) this.notificationCallbacks.splice(index, 1);\n                });\n                break;\n\n            // TODO remvoving connect missing\n\n            // default:\n            //     this.connection.removeListener(type, callback);\n            //     break;\n        }\n    }\n\n    /**\n     * Removes all event listeners\n     *\n     * @method removeAllListeners\n     *\n     * @param {String} type 'notifcation', 'connect', 'error', 'end' or 'data'\n     *\n     * @callback callback callback(error, result)\n     */\n    removeAllListeners(type) {\n        // TODO remvoving connect properly missing\n        switch (type) {\n            case 'data':\n                this.notificationCallbacks = [];\n                break;\n            case 'connect':\n                this.connection.addEventListener('open', null);\n                break;\n            case 'end':\n                this.connection.onclose = null;\n                break;\n            case 'error':\n                this.connection.addEventListener('error', null);\n                break;\n            default:\n                // this.connection.removeAllListeners(type);\n                break;\n        }\n    }\n\n    /**\n     * Resets the providers, clears all callbacks\n     *\n     * @method reset\n     *\n     * @callback callback callback(error, result)\n     */\n    reset() {\n        this._timeout();\n        this.notificationCallbacks = [];\n\n        // this.connection.removeAllListeners('error');\n        // this.connection.removeAllListeners('end');\n        // this.connection.removeAllListeners('timeout');\n\n        this.addDefaultEvents();\n    }\n\n    /**\n     * Will close the socket connection\n     *\n     * @method disconnect\n     */\n    disconnect() {\n        if (this.connection) {\n            this.connection.close();\n        }\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file index.js\n * @authors: Fabian Vogelsteller <fabian@ethereum.org>\n * @date 2017\n */\n\nimport isArray from 'underscore-es/isArray';\nimport isFunction from 'underscore-es/isObject';\nimport {errors} from 'web3-core-helpers';\nimport oboe from 'oboe';\n\nexport default class IpcProvider {\n    /**\n     * @param {String} path\n     * @param {Net} net\n     *\n     * @constructor\n     */\n    constructor(path, net) {\n        this.responseCallbacks = {};\n        this.notificationCallbacks = [];\n        this.path = path;\n        this.connected = false;\n\n        this.connection = net.connect({path: this.path});\n\n        this.addDefaultEvents();\n\n        // LISTEN FOR CONNECTION RESPONSES\n        const callback = (result) => {\n            let id = null;\n\n            // get the id which matches the returned id\n            if (isArray(result)) {\n                result.forEach((load) => {\n                    if (this.responseCallbacks[load.id]) id = load.id;\n                });\n            } else {\n                id = result.id;\n            }\n\n            // notification\n            if (!id && result.method.indexOf('_subscription') !== -1) {\n                this.notificationCallbacks.forEach((callback) => {\n                    if (isFunction(callback)) callback(result);\n                });\n\n                // fire the callback\n            } else if (this.responseCallbacks[id]) {\n                this.responseCallbacks[id](null, result);\n                delete this.responseCallbacks[id];\n            }\n        };\n\n        // use oboe.js for Sockets\n        if (net.constructor.name === 'Socket') {\n            oboe(this.connection).done(callback);\n        } else {\n            this.connection.on('data', (data) => {\n                this._parseResponse(data.toString()).forEach(callback);\n            });\n        }\n    }\n\n    /**\n     * Will add the error and end event to timeout existing calls\n     *\n     * @method addDefaultEvents\n     */\n    addDefaultEvents() {\n        this.connection.on('connect', () => {\n            this.connected = true;\n        });\n\n        this.connection.on('close', () => {\n            this.connected = false;\n        });\n\n        this.connection.on('error', () => {\n            this._timeout();\n        });\n\n        this.connection.on('end', () => {\n            this._timeout();\n        });\n\n        this.connection.on('timeout', () => {\n            this._timeout();\n        });\n    }\n\n    /**\n     * Will parse the response and make an array out of it.\n     * NOTE, this exists for backwards compatibility reasons.\n     *\n     * @method _parseResponse\n     *\n     * @param {String} data\n     *\n     * @returns {Array}\n     */\n    _parseResponse(data) {\n        const returnValues = [];\n\n        // DE-CHUNKER\n        const dechunkedData = data\n            .replace(/\\}[\\n\\r]?\\{/g, '}|--|{') // }{\n            .replace(/\\}\\][\\n\\r]?\\[\\{/g, '}]|--|[{') // }][{\n            .replace(/\\}[\\n\\r]?\\[\\{/g, '}|--|[{') // }[{\n            .replace(/\\}\\][\\n\\r]?\\{/g, '}]|--|{') // }]{\n            .split('|--|');\n\n        dechunkedData.forEach((data) => {\n            let result = null;\n\n            // prepend the last chunk\n            if (this.lastChunk) {\n                data = this.lastChunk + data;\n            }\n\n            try {\n                result = JSON.parse(data);\n            } catch (error) {\n                this.lastChunk = data;\n\n                // start timeout to cancel all requests\n                clearTimeout(this.lastChunkTimeout);\n\n                this.lastChunkTimeout = setTimeout(() => {\n                    this._timeout();\n                    throw errors.InvalidResponse(data);\n                }, 1000 * 15);\n\n                return;\n            }\n\n            // cancel timeout and set chunk to null\n            clearTimeout(this.lastChunkTimeout);\n            this.lastChunk = null;\n\n            if (result) {\n                returnValues.push(result);\n            }\n        });\n\n        return returnValues;\n    }\n\n    /**\n     * Get the adds a callback to the responseCallbacks object,\n     * which will be called if a response matching the response Id will arrive.\n     *\n     * @method _addResponseCallback\n     *\n     * @callback callback callback(error, result)\n     */\n    _addResponseCallback(payload, callback) {\n        const id = payload.id || payload[0].id;\n        const method = payload.method || payload[0].method;\n\n        this.responseCallbacks[id] = callback;\n        this.responseCallbacks[id].method = method;\n    }\n\n    /**\n     * Timeout all requests when the end/error event is fired\n     *\n     * @method _timeout\n     */\n    _timeout() {\n        for (const key in this.responseCallbacks) {\n            if (this.responseCallbacks.hasOwnProperty(key)) {\n                this.responseCallbacks[key](errors.InvalidConnection('on IPC'));\n                delete this.responseCallbacks[key];\n            }\n        }\n    }\n\n    /**\n     * Try to reconnect\n     *\n     * @method reconnect\n     */\n    reconnect() {\n        this.connection.connect({path: this.path});\n    }\n\n    /**\n     * Sends the JSON-RPC the request\n     *\n     * @method send\n     *\n     * @param {Object} payload\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    send(payload, callback) {\n        // try reconnect, when connection is gone\n        if (!this.connection.writable) {\n            this.connection.connect({path: this.path});\n        }\n\n        this.connection.write(JSON.stringify(payload));\n        this._addResponseCallback(payload, callback);\n    }\n\n    /**\n     * Subscribes to provider events.provider\n     *\n     * @method on\n     *\n     * @param {String} type 'notification', 'connect', 'error', 'end' or 'data'\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    on(type, callback) {\n        if (typeof callback !== 'function') {\n            throw new TypeError('The second parameter callback must be a function.');\n        }\n\n        switch (type) {\n            case 'data':\n                this.notificationCallbacks.push(callback);\n                break;\n\n            // adds error, end, timeout, connect\n            default:\n                this.connection.on(type, callback);\n                break;\n        }\n    }\n\n    /**\n     * Subscribes to provider events.provider\n     *\n     * @method on\n     *\n     * @param {String} type 'connect', 'error', 'end' or 'data'\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    once(type, callback) {\n        if (typeof callback !== 'function') {\n            throw new TypeError('The second parameter callback must be a function.');\n        }\n\n        this.connection.once(type, callback);\n    }\n\n    /**\n     * Removes event listener\n     *\n     * @method removeListener\n     *\n     * @param {String} type 'data', 'connect', 'error', 'end' or 'data'\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    removeListener(type, callback) {\n        switch (type) {\n            case 'data':\n                this.notificationCallbacks.forEach((cb, index) => {\n                    if (cb === callback) this.notificationCallbacks.splice(index, 1);\n                });\n                break;\n\n            default:\n                this.connection.removeListener(type, callback);\n                break;\n        }\n    }\n\n    /**\n     * Removes all event listeners\n     *\n     * @method removeAllListeners\n     *\n     * @param {String} type 'data', 'connect', 'error', 'end' or 'data'\n     *\n     * @callback callback callback(error, result)\n     */\n    removeAllListeners(type) {\n        switch (type) {\n            case 'data':\n                this.notificationCallbacks = [];\n                break;\n\n            default:\n                this.connection.removeAllListeners(type);\n                break;\n        }\n    }\n\n    /**\n     * Resets the providers, clears all callbacks\n     *\n     * @method reset\n     */\n    reset() {\n        this._timeout();\n        this.notificationCallbacks = [];\n\n        this.connection.removeAllListeners('error');\n        this.connection.removeAllListeners('end');\n        this.connection.removeAllListeners('timeout');\n\n        this.addDefaultEvents();\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file httpprovider.js\n * @authors:\n *   Marek Kotewicz <marek@parity.io>\n *   Marian Oancea\n *   Fabian Vogelsteller <fabian@ethereum.org>\n * @date 2015\n */\n\nimport {errors} from 'web3-core-helpers';\nimport {XMLHttpRequest} from 'xhr2-cookies';\nimport http from 'http';\nimport https from 'https';\n\nexport default class HttpProvider {\n    /**\n     * @param {String} host\n     * @param {Object} options\n     *\n     * @constructor\n     */\n    constructor(host, options = {}) {\n        this.host = host || 'http://localhost:8545';\n\n        if (this.host.substring(0, 5) === 'https') {\n            this.httpsAgent = new https.Agent({keepAlive: true});\n        } else {\n            this.httpAgent = new http.Agent({keepAlive: true});\n        }\n\n        this.timeout = options.timeout || 0;\n        this.headers = options.headers;\n        this.connected = false;\n    }\n\n    /**\n     * Prepares the HTTP request\n     *\n     * @private\n     * @method _prepareRequest\n     *\n     * @returns {FakeXHR2}\n     */\n    _prepareRequest() {\n        const request = new XMLHttpRequest();\n        request.nodejsSet({\n            httpsAgent: this.httpsAgent,\n            httpAgent: this.httpAgent\n        });\n\n        request.open('POST', this.host, true);\n        request.setRequestHeader('Content-Type', 'application/json');\n        request.timeout = this.timeout && this.timeout !== 1 ? this.timeout : 0;\n        request.withCredentials = true;\n\n        if (this.headers) {\n            this.headers.forEach((header) => {\n                request.setRequestHeader(header.name, header.value);\n            });\n        }\n\n        return request;\n    }\n\n    /**\n     * Should be used to make async request\n     *\n     * @method send\n     *\n     * @param {Object} payload\n     * @param {Function} callback\n     *\n     * @callback callback callback(error, result)\n     */\n    send(payload, callback) {\n        const request = this._prepareRequest();\n\n        request.onreadystatechange = () => {\n            if (request.readyState === 4 && request.timeout !== 1) {\n                let result = request.responseText;\n\n                try {\n                    result = JSON.parse(result);\n                } catch (error) {\n                    const invalidResponseError = errors.InvalidResponse(request.responseText);\n                    callback(invalidResponseError, result);\n                }\n\n                this.connected = true;\n            }\n        };\n\n        request.ontimeout = function() {\n            this.connected = false;\n            callback(errors.ConnectionTimeout(this.timeout));\n        };\n\n        try {\n            request.send(JSON.stringify(payload));\n        } catch (error) {\n            this.connected = false;\n            callback(errors.InvalidConnection(this.host));\n        }\n    }\n\n    /**\n     * If this method does not exist it will throw en error.\n     */\n    disconnect() {}\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file Batch.js\n * @author Samuel Furter <samuel@ethereum.org>, Marek Kotewicz <marek@ethdev.com>\n * @date 2018\n */\n\nimport {errors} from 'web3-core-helpers';\nimport isFunction from 'underscore-es/isFunction';\nimport isObject from 'underscore-es/isObject';\nimport isArray from 'underscore-es/isArray';\n\nexport default class BatchRequest {\n    /**\n     * @param {AbstractProviderAdapter} provider\n     * @param {JsonRpcMapper} jsonRpcMapper\n     * @param {JsonRpcResponseValidator} jsonRpcResponseValidator\n     *\n     * @constructor\n     */\n    constructor(provider, jsonRpcMapper, jsonRpcResponseValidator) {\n        this.provider = provider;\n        this.jsonRpcMapper = jsonRpcMapper;\n        this.jsonRpcResponseValidator = jsonRpcResponseValidator;\n        this.requests = [];\n    }\n\n    /**\n     * Should be called to add create new request to batch request\n     *\n     * @method add\n     *\n     * @param {Object} request\n     */\n    add(request) {\n        this.requests.push(request);\n    }\n\n    /**\n     * Should be called to execute batch request\n     *\n     * @method execute\n     */\n    execute() {\n        this.provider.sendBatch(this.jsonRpcMapper.toBatchPayload(this.requests), (error, results) => {\n            this.requests.forEach(function(request, index) {\n                if (!error) {\n                    if (!isArray(results)) {\n                        request.callback(errors.InvalidResponse(results));\n\n                        return;\n                    }\n\n                    const result = results[index] || null;\n\n                    if (isFunction(request.callback)) {\n                        if (isObject(result) && result.error) {\n                            request.callback(errors.ErrorResponse(result));\n                        }\n\n                        if (!this.jsonRpcResponseValidator.isValid(result)) {\n                            request.callback(errors.InvalidResponse(result));\n                        }\n\n                        try {\n                            const mappedResult = request.afterExecution(result.result);\n                            request.callback(null, mappedResult);\n                        } catch (error) {\n                            request.callback(error, null);\n                        }\n                    }\n\n                    return;\n                }\n\n                request.callback(error);\n            });\n        });\n    }\n\n    /**\n     * Checks if the method has an outputFormatter defined\n     *\n     * @method hasOutputFormatter\n     *\n     * @param {Object} request\n     *\n     * @returns {Boolean}\n     */\n    hasOutputFormatter(request) {\n        return isFunction(request.methodModel.outputFormatter);\n    }\n}\n","/*\n    This file is part of web3.js.\n\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file ProviderPackageFactory.js\n * @authors: Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nimport ProviderResolver from '../resolvers/ProviderResolver';\nimport ProviderDetector from '../detectors/ProviderDetector';\nimport SocketProviderAdapter from '../adapters/SocketProviderAdapter';\nimport InpageProviderAdapter from '../adapters/InpageProviderAdapter';\nimport HttpProviderAdapter from '../adapters/HttpProviderAdapter';\nimport WebsocketProvider from '../providers/WebsocketProvider';\nimport IpcProvider from '../providers/IpcProvider';\nimport HttpProvider from '../providers/HttpProvider';\nimport JsonRpcResponseValidator from '../validators/JsonRpcResponseValidator';\nimport JsonRpcMapper from '../mappers/JsonRpcMapper';\nimport BatchRequest from '../batch-request/BatchRequest';\n\nexport default class ProvidersModuleFactory {\n    /**\n     * Returns an BatchRequest object\n     *\n     * @method createBatchRequest\n     *\n     * @param {AbstractProviderAdapter} provider\n     *\n     * @returns {BatchRequest}\n     */\n    createBatchRequest(provider) {\n        return new BatchRequest(provider, JsonRpcMapper, JsonRpcResponseValidator);\n    }\n\n    /**\n     * Returns an ProviderResolver object\n     *\n     * @method createProviderResolver\n     *\n     * @returns {ProviderResolver}\n     */\n    createProviderResolver() {\n        return new ProviderResolver(this);\n    }\n\n    /**\n     * Returns an ProviderDetector object\n     *\n     * @method createProviderDetector\n     *\n     * @returns {ProviderDetector}\n     */\n    createProviderDetector() {\n        return new ProviderDetector();\n    }\n\n    /**\n     * Returns an HttpProvider object\n     *\n     * @method createHttpProvider\n     *\n     * @param {String} url\n     *\n     * @returns {HttpProvider}\n     */\n    createHttpProvider(url) {\n        return new HttpProvider(url);\n    }\n\n    /**\n     * Return an WebsocketProvider object\n     *\n     * @method createWebsocketProvider\n     *\n     * @param {String} url\n     *\n     * @returns {WebsocketProvider}\n     */\n    createWebsocketProvider(url) {\n        return new WebsocketProvider(url);\n    }\n\n    /**\n     * Returns an IpcProvider object\n     *\n     * @method createIpcProvider\n     *\n     * @param {String} path\n     * @param {Net} net\n     *\n     * @returns {IpcProvider}\n     */\n    createIpcProvider(path, net) {\n        return new IpcProvider(path, net);\n    }\n\n    /**\n     * Returns an HttpProviderAdapter object\n     *\n     * @method createHttpProviderAdapter\n     *\n     * @param {HttpProvider} provider\n     *\n     * @returns {HttpProviderAdapter}\n     */\n    createHttpProviderAdapter(provider) {\n        return new HttpProviderAdapter(provider);\n    }\n\n    /**\n     * Returns an SocketProviderAdapter object\n     *\n     * @method createSocketProviderAdapter\n     *\n     * @param {WebsocketProvider|IpcProvider} provider\n     *\n     * @returns {SocketProviderAdapter}\n     */\n    createSocketProviderAdapter(provider) {\n        return new SocketProviderAdapter(provider);\n    }\n\n    /**\n     * Returns an InpageProviderAdapter object\n     *\n     * @method createInpageProviderAdapter\n     *\n     * @param {Object} provider\n     *\n     * @returns {InpageProviderAdapter}\n     */\n    createInpageProviderAdapter(provider) {\n        return new InpageProviderAdapter(provider);\n    }\n\n    /**\n     * Returns an JsonRpcResponseValidator object\n     *\n     * @method createJSONRpcResponseValidator\n     *\n     * @returns {JsonRpcResponseValidator}\n     */\n    createJSONRpcResponseValidator() {\n        return new JsonRpcResponseValidator();\n    }\n}\n","/*\n    This file is part of web3.js.\n    web3.js is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n    web3.js is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Lesser General Public License for more details.\n    You should have received a copy of the GNU Lesser General Public License\n    along with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n/**\n * @file index.js\n * @author Samuel Furter <samuel@ethereum.org>\n * @date 2018\n */\n\nimport ProvidersModuleFactory from './factories/ProvidersModuleFactory';\nimport HttpProvider from './providers/HttpProvider';\nimport IpcProvider from './providers/IpcProvider';\nimport WebsocketProvider from './providers/WebsocketProvider';\n\nexport SocketProviderAdapter from './adapters/SocketProviderAdapter';\nexport HttpProviderAdapter from './adapters/HttpProviderAdapter';\nexport HttpProvider from './providers/HttpProvider';\nexport IpcProvider from './providers/IpcProvider';\nexport WebsocketProvider from './providers/WebsocketProvider';\nexport JsonRpcResponseValidator from './validators/JsonRpcResponseValidator';\nexport ProvidersModuleFactory from './factories/ProvidersModuleFactory';\n\nexport const providers = {\n    HttpProvider,\n    WebsocketProvider,\n    IpcProvider\n};\n\n/**\n * Creates the BatchRequest object\n *\n * @method BatchRequest\n *\n * @param {AbstractProviderAdapter|EthereumProvider} provider\n *\n * @returns {BatchRequest}\n */\nexport const BatchRequest = (provider) => {\n    return new ProvidersModuleFactory().createBatchRequest(provider);\n};\n\n/**\n * Creates the ProviderResolver object\n *\n * @method ProviderResolver\n *\n * @returns {ProviderResolver}\n */\nexport const ProviderResolver = () => {\n    return new ProvidersModuleFactory().createProviderResolver();\n};\n\n/**\n * Creates the ProviderDetector object\n *\n * @method detect\n *\n * @returns {Object}\n */\nexport const ProviderDetector = () => {\n    return new ProvidersModuleFactory().createProviderDetector();\n};\n"],"names":["ProviderResolver","constructor","providersPackageFactory","resolve","provider","net","test","createHttpProviderAdapter","createHttpProvider","createSocketProviderAdapter","createWebsocketProvider","isObject","isFunction","connect","createIpcProvider","sendAsync","createInpageProviderAdapter","name","Error","global","Function","error","window","ProviderDetector","detect","ethereumProvider","web3","currentProvider","isIpcProviderWrapper","addSubscriptionsToIpcProviderWrapper","on","connection","type","callback","TypeError","data","result","toString","JSON","parse","id","method","indexOf","messageId","JsonRpcMapper","toPayload","params","stringify","jsonrpc","toBatchPayload","requests","map","request","beforeExecution","rpcMethod","parameters","JsonRpcResponseValidator","isValid","response","Array","isArray","every","isResponseItemValid","undefined","AbstractProviderAdapter","EventEmitter","send","payload","Promise","reject","handleResponse","sendBatch","subscribe","unsubscribe","errors","ErrorResponse","InvalidResponse","isConnected","connected","SocketProviderAdapter","host","path","subscriptions","registerSubscriptionListener","subscriptionType","subscriptionMethod","unshift","then","subscriptionId","push","filter","subscription","deprecatedResponse","hasSubscription","emit","clearSubscriptions","unsubscribePromises","forEach","all","reset","removeSubscription","InpageProviderAdapter","inpageProvider","HttpProviderAdapter","httpProvider","Ws","_btoa","parseURL","WebSocket","url","protocols","btoa","URL","require","w3cwebsocket","str","Buffer","from","NewURL","WebsocketProvider","options","responseCallbacks","notificationCallbacks","_customTimeout","timeout","parsedURL","headers","protocol","username","password","authorization","clientConfig","auth","addDefaultEvents","addEventListener","e","_parseResponse","load","Object","defineProperty","get","readyState","OPEN","enumerable","_timeout","onclose","returnValues","dechunkedData","replace","split","lastChunk","clearTimeout","lastChunkTimeout","setTimeout","_addResponseCallback","ConnectionTimeout","key","hasOwnProperty","InvalidConnection","CONNECTING","console","onerror","removeListener","cb","index","splice","removeAllListeners","disconnect","close","IpcProvider","oboe","done","reconnect","writable","write","once","HttpProvider","substring","httpsAgent","https","Agent","keepAlive","httpAgent","http","_prepareRequest","XMLHttpRequest","nodejsSet","open","setRequestHeader","withCredentials","header","value","onreadystatechange","responseText","invalidResponseError","ontimeout","BatchRequest","jsonRpcMapper","jsonRpcResponseValidator","add","execute","results","mappedResult","afterExecution","hasOutputFormatter","methodModel","outputFormatter","ProvidersModuleFactory","createBatchRequest","createProviderResolver","createProviderDetector","createJSONRpcResponseValidator","providers"],"mappings":"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"}
